#!/bin/sh

ssh='ssh -oCheckHostIP=no -oStrictHostKeyChecking=no -i/tmp/experiment/id_rsa'

chmod 600 /tmp/experiment/id_rsa

# set up all servers, clients and the director itself
while read what type number host port user
do
    [ "$what" = NODE ] || continue
    [ "$type" = director ] && continue
    echo "Copying experiment data to $type$number"
    rsync -avHPe "$ssh -p$port" /tmp/experiment/ $user@$host:/tmp/experiment/ < /dev/null
done < /tmp/experiment/setup-data

